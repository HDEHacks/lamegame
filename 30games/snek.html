<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<title>Snek</title>
	<style>
		body {
			background-color: black;
			color: lime;
		}
		canvas{
			border-style: dashed;
			border-width: 5px;
			border-color: lime;
		}
	</style>
</head>
<body>
<h1>Snek. Wow</h1>
<p id="score">Score: 0</p>
<canvas id="cv" height="400" width="400"></canvas>
<script>
	const fps = 15;
	const h   = 20;
	const w   = 20;
	const sz  = 20;
	const initial = 4;

	let px; // position
	let py; 
	let vx; // velocity
	let vy;
	let ax; // apfel
	let ay;
	let snek;
	let sneksz;

	die(); // sometimes you die first

	function tick() {
		game();
		draw();
	}
	function game() {
		px += vx;
		py += vy;

		if (px >= w) {
			px = 0;
		} else if (py >= h) {
			py = 0;
		} else if (px < 0) {
			px = w - 1;
		} else if (py < 0) {
			py = h - 1;
		}

		if (snek.length > sneksz - 1) {
			snek.shift();
		}

		const ispresent = (element) => element.x === px && element.y === py;

		if (snek.some(ispresent)) {
			die();
		}

		snek.push({x: px, y:py});

		if (px === ax && py === ay) {
			eat();
		}
	}
	function draw() {
		ctx.fillStyle = "black";
		ctx.fillRect(0, 0, h*sz, w*sz);

		ctx.fillStyle = "lime";
		for (let i = 0; i < snek.length; i++) {
			ctx.fillRect(snek[i].x * sz, snek[i].y * sz, sz - 2, sz - 2);
		}

		ctx.fillStyle = "red";
		ctx.fillRect(ax*sz, ay*sz, sz - 2, sz - 2);
	}
	function die() {
		px = 8;
		py = 8;
		vx = 1;
		vy = 0;
		ax = 2;
		ay = 2;
		snek = [{x:px, y:py}];
		sneksz = initial;

		document.getElementById("score").innerHTML = "Score: 0";
	}
	function eat() {
		let randomIntFromInterval = (min,max) => Math.floor(Math.random()*(max-min+1)+min);
		ax = randomIntFromInterval(0, w-1);
		ay = randomIntFromInterval(0, h-1);

		sneksz++;

		document.getElementById("score").innerHTML = "Score: " + (sneksz - initial);
	}
	function down(evt) {
		switch(evt.keyCode){
			case 37:
				if (vx !== 1) {vx = -1; vy = 0;}
				break;
			case 38:
				if (vy !== 1) {vx = 0; vy = -1;}
				break;
			case 39:
				if (vx !== -1) {vx = 1; vy = 0;}
				break;
			case 40:
				if (vy !== -1) {vx = 0; vy = 1;}
				break;
		}
	}
	window.onload = function() {
		ctx = document.getElementById("cv").getContext("2d");
		document.addEventListener("keydown",down);
		setInterval(tick,1000/fps);
	}
</script>
</body>
</html>
